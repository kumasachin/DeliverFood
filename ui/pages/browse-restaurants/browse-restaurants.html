<!doctype html>
<html>

<head>
    <title>Browse Restaurants</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.muicss.com/mui-0.10.3/css/mui.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.muicss.com/mui-0.10.3/js/mui.min.js"></script>

    <link rel="stylesheet" href="../../styles/global.css">
    <link rel="stylesheet" href="browse-restaurants.css" />
    <script src="../../js/app.js"></script>
</head>

<body>
    <div class="page-layout-container">
        <header>
            <div class="mui-appbar mui--appbar-line-height">
                <div class="mui-container-fluid d-flex align-item-center">

                    <div class="app-bar-leading mui-col-md-4">
                        <div class="app-name">
                            üçî Food Delivery
                        </div>
                    </div>
                    <div class="app-bar-center mui-col-md-4">
                        <div class="user-name text-center" id="userWelcome">
                            Welcome!
                        </div>
                    </div>
                    <div class="app-bar-trailing mui-col-md-4">
                        <a href="../../pages/view-orders/customer.html">View Orders</a>
                        <a href="../../pages/cart/cart.html">Cart (<span id="cartCount">0</span>)</a>
                        <a href="#" onclick="Auth.logout()">Sign Out</a>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <div class="layout">
                <div class="header">
                    <div class="mui-container">
                        <br>
                        <div class="title">Browse Restaurants</div>
                        <div class="mui-row" style="width: 102%;">
                            <div>
                                <div class="mui-panel search-bar">
                                    <img class="search-icon" src="../../assets/search.png" />
                                    <input type="text" id="searchInput" placeholder="Search Restaurants" />
                                    <img class="clear-button" src="../../assets/clear.png" onclick="clearSearch()" />
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
                <div class="content">
                    <div class="mui-container" id="restaurantsContainer">
                        <!-- Restaurants will be dynamically loaded here -->
                    </div>
                </div>
                            <div class="mui-panel">
                                <div class="card">
                                    <div class="card-avatar">
                                        <img class="card-image" src="../../assets/restaurant.png" />
                                    </div>
                                    <div class="card-details">
                                        <span class="name">Restaurant name</span>
                                        <div> Description </div>
                                        <div class="section"> Cuisine </div>
                                    </div>
                                    <div class="card-trailing">
                                        <a class="mui-btn mui-btn--flat mui-btn--small buy-button"
                                            href="../browse-meals/browse-meals.html">Browse Meals</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mui-row">
                            <div class="mui-panel">
                                <div class="card">
                                    <div class="card-avatar">
                                        <img class="card-image" src="../../assets/restaurant.png" />
                                    </div>
                                    <div class="card-details">
                                        <span class="name">Restaurant name</span>
                                        <div> Description </div>
                                        <div class="section"> Cuisine </div>
                                    </div>
                                    <div class="card-trailing">
                                        <a class="mui-btn mui-btn--flat mui-btn--small buy-button"
                                            href="../browse-meals/browse-meals.html">Browse Meals</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mui-row">
                            <div class="mui-panel">
                                <div class="card">
                                    <div class="card-avatar">
                                        <img class="card-image" src="../../assets/restaurant.png" />
                                    </div>
                                    <div class="card-details">
                                        <span class="name">Restaurant name</span>
                                        <div> Description </div>
                                        <div class="section"> Cuisine </div>
                                    </div>
                                    <div class="card-trailing">
                                        <a class="mui-btn mui-btn--flat mui-btn--small buy-button"
                                            href="../browse-meals/browse-meals.html">Browse Meals</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mui-row">
                            <div class="mui-panel">
                                <div class="card">
                                    <div class="card-avatar">
                                        <img class="card-image" src="../../assets/restaurant.png" />
                                    </div>
                                    <div class="card-details">
                                        <span class="name">Restaurant name</span>
                                        <div> Description </div>
                                        <div class="section"> Cuisine </div>
                                    </div>
                                    <div class="card-trailing">
                                        <a class="mui-btn mui-btn--flat mui-btn--small buy-button"
                                            href="../browse-meals/browse-meals.html">Browse Meals</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mui-row">
                            <div class="mui-panel">
                                <div class="card">
                                    <div class="card-avatar">
                                        <img class="card-image" src="../../assets/restaurant.png" />
                                    </div>
                                    <div class="card-details">
                                        <span class="name">Restaurant name</span>
                                        <div> Description </div>
                                        <div class="section"> Cuisine </div>
                                    </div>
                                    <div class="card-trailing">
                                        <a class="mui-btn mui-btn--flat mui-btn--small buy-button"
                                            href="../browse-meals/browse-meals.html">Browse Meals</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mui-row">
                            <div class="mui-panel">
                                <div class="card">
                                    <div class="card-avatar">
                                        <img class="card-image" src="../../assets/restaurant.png" />
                                    </div>
                                    <div class="card-details">
                                        <span class="name">Restaurant name</span>
                                        <div> Description </div>
                                        <div class="section"> Cuisine </div>
                                    </div>
                                    <div class="card-trailing">
                                        <a class="mui-btn mui-btn--flat mui-btn--small buy-button"
                                            href="../browse-meals/browse-meals.html">Browse Meals</a>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
                <div class="footer">
                    <div class="pagination">
                        <button class="mui-btn mui-btn--flat mui-btn--small">Previous</button>
                        <button class="mui-btn mui-btn--primary mui-btn--small">1</button>
                        <button class="mui-btn mui-btn--flat mui-btn--small">2</button>
                        <button class="mui-btn mui-btn--flat mui-btn--small">3</button>
                        <button class="mui-btn mui-btn--flat mui-btn--small" disabled>...</button>
                        <button class="mui-btn mui-btn--flat mui-btn--small">8</button>
                        <button class="mui-btn mui-btn--flat mui-btn--small">9</button>
                        <button class="mui-btn mui-btn--flat mui-btn--small">10</button>
                        <button class="mui-btn mui-btn--flat mui-btn--small">Next</button>
                    </div>
                </div>

        </main>

        <footer>
            <div class="text-center">
                Toptal Food Delivery
            </div>
        </footer>
    </div>

    <script>
        let restaurants = [];
        let currentPage = 0;
        const pageSize = 10;

        // Initialize page
        document.addEventListener('DOMContentLoaded', async () => {
            // Check authentication
            if (!Auth.requireAuth()) return;

            // Update user welcome message
            const user = Auth.getCurrentUser();
            if (user && user.email) {
                document.getElementById('userWelcome').textContent = `Welcome, ${user.email}!`;
            }

            // Update cart count
            updateCartCount();

            // Load restaurants
            await loadRestaurants();

            // Setup search functionality
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', Utils.debounce(handleSearch, 300));
        });

        async function loadRestaurants(page = 0) {
            try {
                const response = await API.getRestaurants(page, pageSize);
                restaurants = response.items || response; // Handle both possible response formats
                renderRestaurants(restaurants);
                renderPagination(response.total || restaurants.length, page);
            } catch (error) {
                console.error('Failed to load restaurants:', error);
                Utils.showError('Failed to load restaurants. Please try again.');
            }
        }

        function renderRestaurants(restaurantList) {
            const container = document.getElementById('restaurantsContainer');
            
            if (restaurantList.length === 0) {
                container.innerHTML = `
                    <div class="mui-row">
                        <div class="mui-col-md-12 text-center">
                            <h3>No restaurants found</h3>
                            <p>Try adjusting your search criteria.</p>
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = restaurantList.map(restaurant => `
                <div class="mui-row">
                    <div class="mui-panel">
                        <div class="card">
                            <div class="card-avatar">
                                <img class="card-image" src="../../assets/restaurants/restaurant.png" 
                                     onerror="this.src='../../assets/restaurant.png'" />
                            </div>
                            <div class="card-details">
                                <span class="name">${escapeHtml(restaurant.title)}</span>
                                <div>${escapeHtml(restaurant.description)}</div>
                                <div class="section">${escapeHtml(restaurant.cuisine)}</div>
                            </div>
                            <div class="card-trailing">
                                <a class="mui-btn mui-btn--flat mui-btn--small buy-button"
                                   href="../browse-meals/browse-meals.html?restaurant=${restaurant.uuid}">
                                   Browse Meals
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderPagination(total, currentPageNum) {
            // Simple pagination for now - could be enhanced
            currentPage = currentPageNum;
            // Pagination logic would go here
        }

        function handleSearch(event) {
            const searchTerm = event.target.value.toLowerCase();
            if (searchTerm === '') {
                renderRestaurants(restaurants);
                return;
            }

            const filtered = restaurants.filter(restaurant =>
                restaurant.title.toLowerCase().includes(searchTerm) ||
                restaurant.description.toLowerCase().includes(searchTerm) ||
                restaurant.cuisine.toLowerCase().includes(searchTerm)
            );
            renderRestaurants(filtered);
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            renderRestaurants(restaurants);
        }

        function updateCartCount() {
            const count = Cart.getItemCount();
            document.getElementById('cartCount').textContent = count;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>

</html>
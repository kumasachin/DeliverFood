<!DOCTYPE html>
<html>
  <head>
    <title>Sign In</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.muicss.com/mui-0.10.3/css/mui.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <script src="https://cdn.muicss.com/mui-0.10.3/js/mui.min.js"></script>

    <link rel="stylesheet" href="../../styles/global.css" />
    <link rel="stylesheet" href="sign-in.css" />
    <script src="../../js/app.js"></script>
  </head>

  <body>
    <div class="sign-in-container">
      <div class="sign-in-container-header">
        üçî Food Delivery
        <div class="sign-in-container-sub-header">
          Enter your credentials to access your account
        </div>
      </div>
      <form class="mui-form" id="signInForm">
        <div class="login-container-label">Email Address</div>
        <div class="mui-textfield">
          <input
            type="email"
            id="email"
            placeholder="Enter your email"
            required
          />
        </div>
        <div class="login-container-label">Password</div>

        <div class="mui-textfield">
          <input
            type="password"
            id="password"
            placeholder="Enter your password"
            required
          />
        </div>

        <div class="login-container-forgot-password">
          <a href="#">Forgot Password?</a>
        </div>

        <button type="submit" class="mui-btn mui-btn--raised mui-btn--primary">
          Sign In
        </button>
      </form>
      <button class="mui-btn mui-btn--raised">
        <img
          class="login-container-google"
          src="https://img.icons8.com/color/48/null/google-logo.png"
        />
        Sign in with Google
      </button>

      <div class="sign-in-container-sign-up">
        Don't have an account? <a href="../sign-up/sign-up.html">Sign up</a>
      </div>
    </div>

    <script>
      // Check if user is already authenticated
      if (Auth.isAuthenticated()) {
        const user = Auth.getCurrentUser();
        if (user.role === "customer") {
          window.location.href =
            "../browse-restaurants/browse-restaurants.html";
        } else if (user.role === "owner") {
          window.location.href = "../create/restaurant.html";
        } else {
          window.location.href = "../view-orders/admin.html";
        }
      }

      document
        .getElementById("signInForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          try {
            const response = await API.login(email, password);

            // Store user info from login response
            const user = response.user || { email, role: "customer" };

            Auth.login(response.token, user);

            // Redirect based on role
            if (user.role === "customer") {
              window.location.href =
                "../browse-restaurants/browse-restaurants.html";
            } else if (user.role === "owner") {
              window.location.href = "../create/restaurant.html";
            } else {
              window.location.href = "../view-orders/admin.html";
            }
          } catch (error) {
            Utils.showError(
              error.message || "Sign in failed. Please check your credentials."
            );
          }
        });
    </script>
  </body>
</html>

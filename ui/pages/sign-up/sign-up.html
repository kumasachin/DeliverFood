<!DOCTYPE html>
<html>
  <head>
    <title>Sign Up</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.muicss.com/mui-0.10.3/css/mui.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <script src="https://cdn.muicss.com/mui-0.10.3/js/mui.min.js"></script>

    <link rel="stylesheet" href="../../styles/global.css" />
    <link rel="stylesheet" href="sign-up.css" />
    <script src="../../js/app.js"></script>
  </head>

  <body>
    <div class="sign-up-container">
      <div class="sign-up-container-header">
        üçî Food Delivery
        <div class="sign-up-container-sub-header">
          Enter your credentials to create your account
        </div>
      </div>
      <form class="mui-form" id="signUpForm">
        <div class="sign-up-container-label">Email Address</div>
        <div class="mui-textfield">
          <input
            type="email"
            id="email"
            placeholder="Enter your email"
            required
          />
        </div>
        <div class="sign-up-container-label">Password</div>
        <div class="mui-textfield" style="margin-bottom: 35px">
          <input
            type="password"
            id="password"
            placeholder="Enter your password"
            required
            minlength="8"
          />
        </div>
        <div class="mui-select">
          <select name="role" id="role" required>
            <option value="" disabled selected>Type</option>
            <option value="customer">Regular User</option>
            <option value="owner">Restaurant Owner</option>
          </select>
          <label>Type</label>
        </div>

        <button type="submit" class="mui-btn mui-btn--raised mui-btn--primary">
          Sign Up
        </button>
      </form>

      <button class="mui-btn mui-btn--raised">
        <img
          class="signup-container-google"
          src="https://img.icons8.com/color/48/null/google-logo.png"
        />
        Sign up with Google
      </button>
      <div class="sign-up-container-sign-up">
        Already have an account? <a href="../sign-in/sign-in.html">Sign in</a>
      </div>
    </div>

    <script>
      // Check if user is already authenticated
      if (Auth.isAuthenticated()) {
        const user = Auth.getCurrentUser();
        if (user.role === "customer") {
          window.location.href =
            "../browse-restaurants/browse-restaurants.html";
        } else if (user.role === "owner") {
          window.location.href = "../create/restaurant.html";
        } else {
          window.location.href = "../view-orders/admin.html";
        }
      }

      document
        .getElementById("signUpForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;
          const role = document.getElementById("role").value;

          if (!role) {
            Utils.showError("Please select a user type.");
            return;
          }

          try {
            const response = await API.register(email, password, role);

            // Store user info from registration response
            const user = {
              uuid: response.uuid,
              email: response.email,
              role: response.role,
            };

            Auth.login(response.token, user);

            // Redirect based on role
            if (role === "customer") {
              window.location.href =
                "../browse-restaurants/browse-restaurants.html";
            } else if (role === "owner") {
              window.location.href = "../create/restaurant.html";
            } else {
              window.location.href = "../view-orders/admin.html";
            }
          } catch (error) {
            Utils.showError(
              error.message || "Sign up failed. Please try again."
            );
          }
        });
    </script>
  </body>
</html>
